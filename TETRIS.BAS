10 DEFINT A-Z:PRINT "Loading...";:STAGEW=10:STAGEH=20
20 DIM PW2(15),BLK(19,10),STAGE(20,11),BM(2,4)
30 FOR I=0 TO 14:PW2(I)=2^I:NEXT I
39 FOR I=0 TO 18:FOR J=0 TO 9:READ BLK(I,J):NEXT J:NEXT I
40 DATA 1,2,2,3,3,0,0,0,0,0
41 DATA 2,4,1,15,0,0,0,2,2,-2
42 DATA 2,1,4,1,1,1,1,1,-2,2
43 DATA 3,2,3,2,3,1,0,4,1,0
44 DATA 3,3,2,3,6,0,0,3,-1,0
45 DATA 4,2,3,1,3,2,0,6,0,0
46 DATA 4,3,2,6,3,0,0,5,0,0
47 DATA 5,2,3,1,3,1,0,8,0,1
48 DATA 5,3,2,7,2,0,0,9,1,-1
49 DATA 5,2,3,2,3,2,0,10,-1,0
50 DATA 5,3,2,2,7,0,0,7,0,0
51 DATA 6,2,3,3,1,1,0,12,0,1
52 DATA 6,3,2,7,4,0,0,13,1,-1
53 DATA 6,2,3,2,2,3,0,14,-1,0
54 DATA 6,3,2,1,7,0,0,11,0,0
55 DATA 7,2,3,3,2,2,0,16,-1,0
56 DATA 7,3,2,4,7,0,0,17,0,0
57 DATA 7,2,3,1,1,3,0,18,0,1
58 DATA 7,3,2,7,1,0,0,15,0,-1
60 ACT=0:X=0:Y=0:BCUR=0:RANDOMIZE TIMER:BNEXT=(RND*100) MOD 19
70 CLS:WIDTH 40:LOCATE ,,0
80 COLOR 9,1:LOCATE 2,15
90 PRINT CHR$(201);:FOR I=1 TO STAGEW:PRINT CHR$(205);:NEXT I:PRINT CHR$(187);
100 FOR I=1 TO STAGEH
110 LOCATE I+2,15:PRINT CHR$(186);:LOCATE I+2,26:PRINT CHR$(186);
120 NEXT I
130 LOCATE 3+STAGEH,15
140 PRINT CHR$(200);:FOR I=1 TO STAGEW:PRINT CHR$(205);:NEXT I:PRINT CHR$(188);
150 COLOR 7,0:LOCATE 3,6,0:PRINT "SCORE":LOCATE 3,30:PRINT "NEXT"
160 GOSUB 1000:TS0#=TIMER:WHILE ACT<=3:K$=INKEY$
170 IF K$=CHR$(0)+CHR$(75) THEN ACT=1:GOSUB 700
180 IF K$=CHR$(0)+CHR$(77) THEN ACT=2:GOSUB 750
190 TS#=TIMER:IF TS#-TS0#<0.5 THEN GOTO 480
200 TS0#=TS#:IF Y>=STAGEH-BLKH THEN GOTO 300
210 HTBM=0:HTY=Y+1:GOSUB 600:IF HT=0 THEN GOTO 220 ELSE GOTO 300
220 C=32:GOSUB 2000:Y=Y+1:C=219:GOSUB 2000:GOTO 480
300 GOSUB 1000
480 WEND
490 SCREEN 0:COLOR 7,0:WIDTH 80:CLS:END

600 REM Hit Test
610 HT=0:FOR HTI=0 TO BLKH
620 IF (STAGE(HTY+HTI,0) AND BM(HTBM,HTI))<>0 THEN HT=1:RETURN
630 NEXT HTI:RETURN
700 REM Move left
701 IF X<1 THEN RETURN
710 FOR I=0 TO 4:BM(1,I)=BM(0,I)*2:NEXT I
720 HTBM=1:HTY=Y:GOSUB 600:IF HT=1 THEN RETURN
730 C=32:GOSUB 2000:X=X-1:C=219:GOTO 2000
750 REM Move right
751 IF X>=STAGEW-BLKW THEN RETURN
760 FOR I=0 TO 4:BM(1,I)=BM(0,I)\2:NEXT I
770 HTBM=1:HTY=Y:GOSUB 600:IF HT=1 THEN RETURN
780 C=32:GOSUB 2000:X=X+1:C=219:GOTO 2000
800 REM Rotate
801 BR=BLK(BCUR,7):X2=X+BLK(BCUR,8):Y2=Y+BLK(BCUR,9)
810 BLKWR=BLK(BR,1):BLKHR=BLK(BR,2)
820 IF X2<0 THEN X2=0 ELSE IF X2>=STAGEW-BLKWR THEN X2=STAGEW-BLKWR
830 IF Y2<0 THEN Y2=0 ELSE IF Y2>=STAGEH-BLKHR THEN Y2=STAGEH-BLKHR
840 PW2S=PW2(STAGEW-1-X2):FOR I=0 TO 4:BM(1,I)=BLK(BR,3+I)*PW2S:NEXT I
850 HTBM=1:HTY=Y:GOSUB 600:IF HT=1 THEN RETURN
860 C=32:GOSUB 2000:X=X2:Y=Y2:C=219:GOTO 2000


1000 REM Next block
1001 BCUR=BNEXT:BNEXT=(RND*100) MOD 19:COLOR BLK(BCUR,0)
1010 BLKW=BLK(BCUR,1):BLKH=BLK(BCUR,2):X=(STAGEW-BLKW)/2:Y=0
1020 FOR I=0 TO 3:BM(0,I)=BLK(BCUR,I+3)*PW2(STAGEW-BLKW-X):NEXT I
1030 HTBM=0:HTY=0:GOSUB 900:IF HT=1 THEN ACT=5:RETURN
1050 C=219:GOSUB 2000:RETURN

2000 COLOR BLK(BCUR,0):ON BCUR GOTO 2010,2020,2030,2040,2050,2060,2070,2080,2090
1400 LOCATE Y+3,X+16:PRINT STRING$(2,C);
1401 LOCATE Y+4,X+16:PRINT STRING$(2,C);:RETURN
1410 LOCATE Y+3,X+16:PRINT STRING$(4,C);:RETURN
1420 LOCATE Y+3,X+16:PRINT CHR$(C);:LOCATE Y+4,X+16:PRINT CHR$(C);
1421 LOCATE Y+5,X+16:PRINT CHR$(C);:LOCATE Y+6,X+16:PRINT CHR$(C);:RETURN
1430 LOCATE Y+3,X+16:PRINT CHR$(C);:LOCATE Y+4,X+16:PRINT STRING$(2,C);
1431 LOCATE Y+5,X+17:PRINT CHR$(C);:RETURN
1440 LOCATE Y+3,X+17:PRINT STRING$(2,C);:LOCATE Y+4,X+16:PRINT STRING$(2,C);:RETURN
1450 LOCATE Y+3,X+16:PRINT CHR$(C);:LOCATE Y+4,X+16:PRINT STRING$(2,C);
1451 LOCATE Y+5,X+17:PRINT CHR$(C);:RETURN
1460 LOCATE Y+3,X+17:PRINT STRING$(2,C);:LOCATE Y+4,X+16:PRINT STRING$(2,C);:RETURN
