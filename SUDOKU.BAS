DEFINT A-Z

DIM SHARED BOARD(9,9)
' INPUT "Filename: ", F$
F$="sudoku.txt"
OPEN F$ FOR INPUT AS #1
FOR Y=0 TO 8:FOR X=0 TO 8
  INPUT #1,BOARD(Y,X)
NEXT X:NEXT Y
CLOSE #1

CALL CHECKBOARD
DIM SHARED CAND(9,9)

FUNCTION CHECKPOSFILLED(X,Y)
  NUMS = 0
  FOR I = 0 TO 8
    N = BOARD(Y, I)
    IF N<>0 AND X<>I THEN
      IF (NUMS AND (2^N)) <> 0 THEN
        CHECKPOSFILLED = 0
        EXIT FUNCTION
      ELSE
        NUMS = NUMS OR (2^N)
      END IF
    END IF
    N = BOARD(I, X)
    IF N<>0 AND Y<>I THEN
      IF (NUMS AND (2^N)) <> 0 THEN
        CHECKPOSFILLED = 0
        EXIT FUNCTION
      ELSE
        NUMS = NUMS OR (2^N)
      END IF
    END IF
  NEXT I

  OX = INT(X/3)*3 : OY = INT(Y/3)*3
  FOR I = OY TO OY+2 : FOR J = OX TO OX+2
    N = BOARD(I, J)
    IF N<>0 AND X<>J AND Y<>I THEN
      IF (NUMS AND (2^N)) <> 0 THEN
        CHECKPOSFILLED = 0
        EXIT FUNCTION
      ELSE
        NUMS = NUMS OR (2^N)
      END IF
    END IF
  NEXT J : NEXT I
  CHECKPOSFILLED = 1
END FUNCTION

FUNCTION CHECKPOSEMPTY(X,Y)
  NUMS = 0
  FOR I = 0 TO 8
    NUMS = NUMS OR (2^BOARD(Y,I)) OR (2^BOARD(I,X))
  NEXT I
  OX = INT(X/3)*3 : OY = INT(Y/3)*3
  FOR I = OY TO OY+2 : FOR J = OX TO OX+2
    NUMS = NUMS OR (2^BOARD(I,J))
  NEXT J : NEXT I
  NUMS = NUMS AND &Hfffe
  IF NUMS=&H3fe THEN CHECKPOSEMPTY = 0 ELSE  CHECKPOSEMPTY = 1
END FUNCTION

SUB CHECKBOARD()
  FOR Y=0 TO 8:FOR X=0 TO 8
    IF BOARD(Y,X)=0 THEN
      IF CHECKPOSEMPTY(X,Y)=0 THEN
      END IF
    ELSE
      IF CHECKPOSFILLED(X,Y)=0 THEN
      END IF
    END IF
  NEXT X:NEXT Y
END SUB