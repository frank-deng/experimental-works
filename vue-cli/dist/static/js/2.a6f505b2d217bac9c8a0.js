webpackJsonp([2],{D65k:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n={},a=/d{1,4}|M{1,4}|YY(?:YY)?|S{1,3}|Do|ZZ|([HhMsDm])\1?|[aA]|"[^"]*"|'[^']*'/g,i="[^\\s]+",o=/\[([^]*?)\]/gm,s=function(){};function u(t,e){for(var r=[],n=0,a=t.length;n<a;n++)r.push(t[n].substr(0,e));return r}function d(t){return function(e,r,n){var a=n[t].indexOf(r.charAt(0).toUpperCase()+r.substr(1).toLowerCase());~a&&(e.month=a)}}function l(t,e){for(t=String(t),e=e||2;t.length<e;)t="0"+t;return t}var f=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],h=["January","February","March","April","May","June","July","August","September","October","November","December"],c=u(h,3),m=u(f,3);n.i18n={dayNamesShort:m,dayNames:f,monthNamesShort:c,monthNames:h,amPm:["am","pm"],DoFn:function(t){return t+["th","st","nd","rd"][t%10>3?0:(t-t%10!=10)*t%10]}};var g={D:function(t){return t.getDate()},DD:function(t){return l(t.getDate())},Do:function(t,e){return e.DoFn(t.getDate())},d:function(t){return t.getDay()},dd:function(t){return l(t.getDay())},ddd:function(t,e){return e.dayNamesShort[t.getDay()]},dddd:function(t,e){return e.dayNames[t.getDay()]},M:function(t){return t.getMonth()+1},MM:function(t){return l(t.getMonth()+1)},MMM:function(t,e){return e.monthNamesShort[t.getMonth()]},MMMM:function(t,e){return e.monthNames[t.getMonth()]},YY:function(t){return l(String(t.getFullYear()),4).substr(2)},YYYY:function(t){return l(t.getFullYear(),4)},h:function(t){return t.getHours()%12||12},hh:function(t){return l(t.getHours()%12||12)},H:function(t){return t.getHours()},HH:function(t){return l(t.getHours())},m:function(t){return t.getMinutes()},mm:function(t){return l(t.getMinutes())},s:function(t){return t.getSeconds()},ss:function(t){return l(t.getSeconds())},S:function(t){return Math.round(t.getMilliseconds()/100)},SS:function(t){return l(Math.round(t.getMilliseconds()/10),2)},SSS:function(t){return l(t.getMilliseconds(),3)},a:function(t,e){return t.getHours()<12?e.amPm[0]:e.amPm[1]},A:function(t,e){return t.getHours()<12?e.amPm[0].toUpperCase():e.amPm[1].toUpperCase()},ZZ:function(t){var e=t.getTimezoneOffset();return(e>0?"-":"+")+l(100*Math.floor(Math.abs(e)/60)+Math.abs(e)%60,4)}},p={D:["\\d\\d?",function(t,e){t.day=e}],Do:["\\d\\d?"+i,function(t,e){t.day=parseInt(e,10)}],M:["\\d\\d?",function(t,e){t.month=e-1}],YY:["\\d\\d?",function(t,e){var r=+(""+(new Date).getFullYear()).substr(0,2);t.year=""+(e>68?r-1:r)+e}],h:["\\d\\d?",function(t,e){t.hour=e}],m:["\\d\\d?",function(t,e){t.minute=e}],s:["\\d\\d?",function(t,e){t.second=e}],YYYY:["\\d{4}",function(t,e){t.year=e}],S:["\\d",function(t,e){t.millisecond=100*e}],SS:["\\d{2}",function(t,e){t.millisecond=10*e}],SSS:["\\d{3}",function(t,e){t.millisecond=e}],d:["\\d\\d?",s],ddd:[i,s],MMM:[i,d("monthNamesShort")],MMMM:[i,d("monthNames")],a:[i,function(t,e,r){var n=e.toLowerCase();n===r.amPm[0]?t.isPm=!1:n===r.amPm[1]&&(t.isPm=!0)}],ZZ:["[^\\s]*?[\\+\\-]\\d\\d:?\\d\\d|[^\\s]*?Z",function(t,e){var r,n=(e+"").match(/([+-]|\d\d)/gi);n&&(r=60*n[1]+parseInt(n[2],10),t.timezoneOffset="+"===n[0]?r:-r)}]};p.dd=p.d,p.dddd=p.ddd,p.DD=p.D,p.mm=p.m,p.hh=p.H=p.HH=p.h,p.MM=p.M,p.ss=p.s,p.A=p.a,n.masks={default:"ddd MMM DD YYYY HH:mm:ss",shortDate:"M/D/YY",mediumDate:"MMM D, YYYY",longDate:"MMMM D, YYYY",fullDate:"dddd, MMMM D, YYYY",shortTime:"HH:mm",mediumTime:"HH:mm:ss",longTime:"HH:mm:ss.SSS"},n.format=function(t,e,r){var i=r||n.i18n;if("number"==typeof t&&(t=new Date(t)),"[object Date]"!==Object.prototype.toString.call(t)||isNaN(t.getTime()))throw new Error("Invalid Date in fecha.format");var s=[];return(e=(e=(e=n.masks[e]||e||n.masks.default).replace(o,function(t,e){return s.push(e),"??"})).replace(a,function(e){return e in g?g[e](t,i):e.slice(1,e.length-1)})).replace(/\?\?/g,function(){return s.shift()})},n.parse=function(t,e,r){var i=r||n.i18n;if("string"!=typeof e)throw new Error("Invalid format in fecha.parse");if(e=n.masks[e]||e,t.length>1e3)return null;var o,s={},u=[],d=(o=e,o.replace(/[|\\{()[^$+*?.-]/g,"\\$&")).replace(a,function(t){if(p[t]){var e=p[t];return u.push(e[1]),"("+e[0]+")"}return t}),l=t.match(new RegExp(d,"i"));if(!l)return null;for(var f=1;f<l.length;f++)u[f-1](s,l[f],i);var h,c=new Date;return!0===s.isPm&&null!=s.hour&&12!=+s.hour?s.hour=+s.hour+12:!1===s.isPm&&12==+s.hour&&(s.hour=0),null!=s.timezoneOffset?(s.minute=+(s.minute||0)-+s.timezoneOffset,h=new Date(Date.UTC(s.year||c.getFullYear(),s.month||0,s.day||1,s.hour||0,s.minute||0,s.second||0,s.millisecond||0))):h=new Date(s.year||c.getFullYear(),s.month||0,s.day||1,s.hour||0,s.minute||0,s.second||0,s.millisecond||0),h};var v=n,M=r("o1UL"),w=r.n(M);function y(t,e,r,n){if(r<=t&&n<=e)return{width:r,height:n};var a=r/n>t/e?r/t:n/e;return{width:r/a,height:n/a}}String.prototype.lpad=function(t,e){for(var r=this;r.length<e;)r=t+r;return r};var D={data:function(){return{formPreparation:{maxWidth:640,maxHeight:640,dither:!1,fileList:[],_validation:{fileList:{required:!0,validator:function(t,e,r){0!=e.length?r():r(new Error("请选择文件"))}},maxWidth:[{required:!0,message:"请填写图片最大宽度"},{type:"number",message:"请输入数字类型的值"}],maxHeight:[{required:!0,message:"请填写图片最大宽度"},{type:"number",message:"请输入数字类型的值"}]}},loading:void 0,reader:void 0,displayResult:!1}},methods:{doProcessFile:function(){var t=this;this.$refs.formPreparation.validate(function(e){e&&t.$refs.fileUpload.submit()})},updateFileList:function(t,e){this.formPreparation.fileList=e},onUploadFile:function(t){if(this.reader)return this.loading=this.$loading.service({fullscreen:!0,text:"正在处理中……",background:"#333333"}),this.reader.readAsDataURL(t),this.formPreparation.filelist=[],!1},onSaveFile:function(t){var e=this.$refs.canvasImage.toDataURL("image/jpeg","image/jpeg"),r=document.createElement("a");r.href=e,r.download="IMG_"+v.format(new Date,"YYYYMMDD_HHMMSS.jpg"),document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(e)},goBack:function(){this.displayResult=!1}},mounted:function(){var t=this,e=function(){if(t.displayResult){var e=t.$refs.canvasImage,r=t.$refs.imageArea,n=y(r.offsetWidth-2,r.offsetHeight-2,e.width,e.height);e.style.width=n.width+"px",e.style.height=n.height+"px"}},r=new FileReader;this.reader=r;var n=new Image,a=new w.a;r.addEventListener("load",function(t){n.src=t.target.result});var i=this;n.addEventListener("load",function(t){var e=y(i.formPreparation.maxWidth,i.formPreparation.maxHeight,this.width,this.height);i.$refs.canvasImage.width=e.width,i.$refs.canvasImage.height=e.height;var r=i.$refs.canvasImage.getContext("2d");r.drawImage(n,0,0,this.width,this.height,0,0,e.width,e.height);var o=i.$refs.canvasImage.width,s=i.$refs.canvasImage.height,u=r.getImageData(0,0,o,s);a.postMessage({imageData:u,dither:i.formPreparation.dither})}),n.addEventListener("error",function(){i.loading&&i.loading.close(),i.$alert("图片加载失败","错误",{type:"error",center:!0,roundButton:!0,showClose:!1,customClass:"dialogFailed"})}),a.addEventListener("message",function(r){r.data.message?alert(r.data.message):(i.$refs.canvasImage.getContext("2d").putImageData(r.data.imageData,0,0),t.displayResult=!0,t.$nextTick(function(){e(),t.loading&&t.loading.close()}))}),window.addEventListener("resize",e)}},b={render:function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"KMeansMainFrame"},[r("el-form",{directives:[{name:"show",rawName:"v-show",value:!t.displayResult,expression:"!displayResult"}],ref:"formPreparation",staticClass:"formPreparation",attrs:{model:t.formPreparation,rules:t.formPreparation._validation,"label-width":"110px"}},[r("el-form-item",{attrs:{label:"选择文件",prop:"fileList"}},[r("el-upload",{ref:"fileUpload",staticClass:"fileUpload",attrs:{action:"","list-type":"picture",multiple:!1,limit:1,"show-file-list":!0,"auto-upload":!1,"on-change":t.updateFileList,"on-remove":t.updateFileList,"before-upload":t.onUploadFile}},[r("el-button",[t._v("打开图片文件")])],1)],1),t._v(" "),r("el-form-item",{attrs:{label:"图片最大宽度",prop:"maxWidth"}},[r("el-input",{model:{value:t.formPreparation.maxWidth,callback:function(e){t.$set(t.formPreparation,"maxWidth",t._n(e))},expression:"formPreparation.maxWidth"}})],1),t._v(" "),r("el-form-item",{attrs:{label:"图片最大高度",prop:"maxHeight"}},[r("el-input",{model:{value:t.formPreparation.maxHeight,callback:function(e){t.$set(t.formPreparation,"maxHeight",t._n(e))},expression:"formPreparation.maxHeight"}})],1),t._v(" "),r("el-form-item",{attrs:{label:"图像抖动",prop:"dither"}},[r("el-switch",{model:{value:t.formPreparation.dither,callback:function(e){t.$set(t.formPreparation,"dither",e)},expression:"formPreparation.dither"}})],1),t._v(" "),r("el-button",{attrs:{type:"primary"},on:{click:t.doProcessFile}},[t._v("开始处理图片")])],1),t._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:t.displayResult,expression:"displayResult"}]},[r("el-button",{attrs:{type:"primary"},on:{click:t.onSaveFile}},[t._v("下载图片")]),r("el-button",{on:{click:t.goBack}},[t._v("返回")]),t._v(" "),r("div",{ref:"imageArea",staticClass:"imageArea"},[r("canvas",{ref:"canvasImage",staticClass:"canvasImage",attrs:{width:"16",height:"16"}})])],1)],1)},staticRenderFns:[]};var Y=r("VU/8")(D,b,!1,function(t){r("Sgpq"),r("T8GS")},"data-v-1db7b51a",null);e.default=Y.exports},Sgpq:function(t,e){},T8GS:function(t,e){},o1UL:function(t,e,r){t.exports=function(){return r("qDT4")('!function(t){var r={};function e(a){if(r[a])return r[a].exports;var n=r[a]={i:a,l:!1,exports:{}};return t[a].call(n.exports,n,n.exports,e),n.l=!0,n.exports}e.m=t,e.c=r,e.d=function(t,r,a){e.o(t,r)||Object.defineProperty(t,r,{configurable:!1,enumerable:!0,get:a})},e.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(r,"a",r),r},e.o=function(t,r){return Object.prototype.hasOwnProperty.call(t,r)},e.p="./",e(e.s="o1UL")}({o1UL:function(t,r,e){"use strict";var a=function(t,r){this.targets=t.slice(),this.src=r};a.prototype={constructor:a,getMinDistance:function(t,r){for(var e,a=t.length,n=void 0,i=0;i<a;i++){var o=t[i],s=r[0]-o[0],h=r[1]-o[1],u=r[2]-o[2],d=s*s+h*h+u*u;(void 0===n||d<n)&&(n=d,e=i)}return e},getCentroids:function(t,r){for(var e=new Array(t.length),a=new Array,n=0;n<t.length;n++)a.push([0,0,0].slice()),e[n]=0;var i=r.length;for(n=0;n<i;n++){var o=r[n],s=this.getMinDistance(t,o);a[s][0]+=o[0],a[s][1]+=o[1],a[s][2]+=o[2],e[s]+=1}var h=0;for(n=0;n<a.length;n++){e[n]&&(a[n][0]/=e[n],a[n][1]/=e[n],a[n][2]/=e[n]);var u=a[n][0]-t[n][0],d=a[n][1]-t[n][1],f=a[n][2]-t[n][2];h+=u*u+d*d+f*f}return{result:a,delta:h/=3*a.length}},getOptimizedPalette(t,r){for(var e=void 0!==r?r:32,a=void 0!==t?t:.1,n=this.targets;e--;){var i=this.getCentroids(n,this.src);if(n=i.result,i.delta<a)break}for(var o=0;o<n.length;o++)for(var s=n[o],h=0;h<s.length;h++)n[o][h]=Math.round(s[h]);return n},getMap:function(t,r){for(var e=r.length,a=[],n=0;n<e;n++){var i=this.getMinDistance(t,r[n]);a.push(t[i].slice())}return a},getMapDither:function(t,r,e,a){for(var n=r.length,i=[],o=0;o<n;o++)i.push(r[o].slice());for(var s=0;s<a;s++)for(var h=0;h<e;h++){var u=i[s*e+h].slice(),d=t[this.getMinDistance(t,u)].slice();i[s*e+h]=d;var f,c=[u[0]-d[0],u[1]-d[1],u[2]-d[2]];if(h+1<e)(f=i[s*e+h+1])[0]=Math.round(f[0]+7*c[0]/16),f[1]=Math.round(f[1]+7*c[1]/16),f[2]=Math.round(f[2]+7*c[2]/16);if(h-1>0&&s+1<a)(f=i[(s+1)*e+h-1])[0]=Math.round(f[0]+3*c[0]/16),f[1]=Math.round(f[1]+3*c[1]/16),f[2]=Math.round(f[2]+3*c[2]/16);if(s+1<a)(f=i[(s+1)*e+h])[0]=Math.round(f[0]+5*c[0]/16),f[1]=Math.round(f[1]+5*c[1]/16),f[2]=Math.round(f[2]+5*c[2]/16);if(h+1<e&&s+1<a)(f=i[(s+1)*e+h+1])[0]=Math.round(f[0]+1*c[0]/16),f[1]=Math.round(f[1]+1*c[1]/16),f[2]=Math.round(f[2]+1*c[2]/16)}return i},process:function(t){return t.dither?this.getMapDither(this.getOptimizedPalette(t.delta,t.times),this.src,t.w,t.h):this.getMap(this.getOptimizedPalette(t.delta,t.times),this.src,t.w,t.h)}};for(var n=[],i=0;i<27;i++){let t=[0,127,255];n.push([t[Math.floor(i/9)%3],t[Math.floor(i/3)%3],t[i%3]])}self.addEventListener("message",function(t){var r=t.data.imageData,e=function(t){for(var r=new Array,e=t.width*t.height,a=t.data,n=0;n<e;n++)r.push([a[4*n],a[4*n+1],a[4*n+2]]);return r}(t.data.imageData),i=new a(n,e).process({w:r.width,h:r.height,dither:t.data.dither});!function(t,r){for(var e=t.width*t.height,a=0;a<e;a++)t.data[4*a]=r[a][0],t.data[4*a+1]=r[a][1],t.data[4*a+2]=r[a][2]}(t.data.imageData,i),self.postMessage({imageData:t.data.imageData})})}});',null)}},qDT4:function(t,e,r){"use strict";var n=window.URL||window.webkitURL;t.exports=function(t,e){try{try{var r;try{(r=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder)).append(t),r=r.getBlob()}catch(e){r=new Blob([t])}return new Worker(n.createObjectURL(r))}catch(e){return new Worker("data:application/javascript,"+encodeURIComponent(t))}}catch(t){if(!e)throw Error("Inline worker is not supported");return new Worker(e)}}}});