webpackJsonp([2],{D65k:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n={},a=/d{1,4}|M{1,4}|YY(?:YY)?|S{1,3}|Do|ZZ|([HhMsDm])\1?|[aA]|"[^"]*"|'[^']*'/g,i="[^\\s]+",o=/\[([^]*?)\]/gm,s=function(){};function u(t,e){for(var r=[],n=0,a=t.length;n<a;n++)r.push(t[n].substr(0,e));return r}function d(t){return function(e,r,n){var a=n[t].indexOf(r.charAt(0).toUpperCase()+r.substr(1).toLowerCase());~a&&(e.month=a)}}function l(t,e){for(t=String(t),e=e||2;t.length<e;)t="0"+t;return t}var c=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],f=["January","February","March","April","May","June","July","August","September","October","November","December"],h=u(f,3),m=u(c,3);n.i18n={dayNamesShort:m,dayNames:c,monthNamesShort:h,monthNames:f,amPm:["am","pm"],DoFn:function(t){return t+["th","st","nd","rd"][t%10>3?0:(t-t%10!=10)*t%10]}};var p={D:function(t){return t.getDate()},DD:function(t){return l(t.getDate())},Do:function(t,e){return e.DoFn(t.getDate())},d:function(t){return t.getDay()},dd:function(t){return l(t.getDay())},ddd:function(t,e){return e.dayNamesShort[t.getDay()]},dddd:function(t,e){return e.dayNames[t.getDay()]},M:function(t){return t.getMonth()+1},MM:function(t){return l(t.getMonth()+1)},MMM:function(t,e){return e.monthNamesShort[t.getMonth()]},MMMM:function(t,e){return e.monthNames[t.getMonth()]},YY:function(t){return l(String(t.getFullYear()),4).substr(2)},YYYY:function(t){return l(t.getFullYear(),4)},h:function(t){return t.getHours()%12||12},hh:function(t){return l(t.getHours()%12||12)},H:function(t){return t.getHours()},HH:function(t){return l(t.getHours())},m:function(t){return t.getMinutes()},mm:function(t){return l(t.getMinutes())},s:function(t){return t.getSeconds()},ss:function(t){return l(t.getSeconds())},S:function(t){return Math.round(t.getMilliseconds()/100)},SS:function(t){return l(Math.round(t.getMilliseconds()/10),2)},SSS:function(t){return l(t.getMilliseconds(),3)},a:function(t,e){return t.getHours()<12?e.amPm[0]:e.amPm[1]},A:function(t,e){return t.getHours()<12?e.amPm[0].toUpperCase():e.amPm[1].toUpperCase()},ZZ:function(t){var e=t.getTimezoneOffset();return(e>0?"-":"+")+l(100*Math.floor(Math.abs(e)/60)+Math.abs(e)%60,4)}},g={D:["\\d\\d?",function(t,e){t.day=e}],Do:["\\d\\d?"+i,function(t,e){t.day=parseInt(e,10)}],M:["\\d\\d?",function(t,e){t.month=e-1}],YY:["\\d\\d?",function(t,e){var r=+(""+(new Date).getFullYear()).substr(0,2);t.year=""+(e>68?r-1:r)+e}],h:["\\d\\d?",function(t,e){t.hour=e}],m:["\\d\\d?",function(t,e){t.minute=e}],s:["\\d\\d?",function(t,e){t.second=e}],YYYY:["\\d{4}",function(t,e){t.year=e}],S:["\\d",function(t,e){t.millisecond=100*e}],SS:["\\d{2}",function(t,e){t.millisecond=10*e}],SSS:["\\d{3}",function(t,e){t.millisecond=e}],d:["\\d\\d?",s],ddd:[i,s],MMM:[i,d("monthNamesShort")],MMMM:[i,d("monthNames")],a:[i,function(t,e,r){var n=e.toLowerCase();n===r.amPm[0]?t.isPm=!1:n===r.amPm[1]&&(t.isPm=!0)}],ZZ:["[^\\s]*?[\\+\\-]\\d\\d:?\\d\\d|[^\\s]*?Z",function(t,e){var r,n=(e+"").match(/([+-]|\d\d)/gi);n&&(r=60*n[1]+parseInt(n[2],10),t.timezoneOffset="+"===n[0]?r:-r)}]};g.dd=g.d,g.dddd=g.ddd,g.DD=g.D,g.mm=g.m,g.hh=g.H=g.HH=g.h,g.MM=g.M,g.ss=g.s,g.A=g.a,n.masks={default:"ddd MMM DD YYYY HH:mm:ss",shortDate:"M/D/YY",mediumDate:"MMM D, YYYY",longDate:"MMMM D, YYYY",fullDate:"dddd, MMMM D, YYYY",shortTime:"HH:mm",mediumTime:"HH:mm:ss",longTime:"HH:mm:ss.SSS"},n.format=function(t,e,r){var i=r||n.i18n;if("number"==typeof t&&(t=new Date(t)),"[object Date]"!==Object.prototype.toString.call(t)||isNaN(t.getTime()))throw new Error("Invalid Date in fecha.format");var s=[];return(e=(e=(e=n.masks[e]||e||n.masks.default).replace(o,function(t,e){return s.push(e),"??"})).replace(a,function(e){return e in p?p[e](t,i):e.slice(1,e.length-1)})).replace(/\?\?/g,function(){return s.shift()})},n.parse=function(t,e,r){var i=r||n.i18n;if("string"!=typeof e)throw new Error("Invalid format in fecha.parse");if(e=n.masks[e]||e,t.length>1e3)return null;var o,s={},u=[],d=(o=e,o.replace(/[|\\{()[^$+*?.-]/g,"\\$&")).replace(a,function(t){if(g[t]){var e=g[t];return u.push(e[1]),"("+e[0]+")"}return t}),l=t.match(new RegExp(d,"i"));if(!l)return null;for(var c=1;c<l.length;c++)u[c-1](s,l[c],i);var f,h=new Date;return!0===s.isPm&&null!=s.hour&&12!=+s.hour?s.hour=+s.hour+12:!1===s.isPm&&12==+s.hour&&(s.hour=0),null!=s.timezoneOffset?(s.minute=+(s.minute||0)-+s.timezoneOffset,f=new Date(Date.UTC(s.year||h.getFullYear(),s.month||0,s.day||1,s.hour||0,s.minute||0,s.second||0,s.millisecond||0))):f=new Date(s.year||h.getFullYear(),s.month||0,s.day||1,s.hour||0,s.minute||0,s.second||0,s.millisecond||0),f};var v=n,M=r("o1UL"),w=r.n(M);function y(t,e,r,n){if(r<=t&&n<=e)return{width:r,height:n};var a=r/n>t/e?r/t:n/e;return{width:r/a,height:n/a}}String.prototype.lpad=function(t,e){for(var r=this;r.length<e;)r=t+r;return r};var D={components:{colorManager:r("svXp").default},data:function(){return{formPreparation:{maxWidth:640,maxHeight:640,dither:!1,fileList:[],colors:[],_validation:{fileList:{required:!0,validator:function(t,e,r){0!=e.length?r():r(new Error("请选择文件"))}},maxWidth:[{required:!0,message:"请填写图片最大宽度"},{type:"number",message:"请输入数字类型的值"}],maxHeight:[{required:!0,message:"请填写图片最大宽度"},{type:"number",message:"请输入数字类型的值"}],colors:{required:!0,validator:function(t,e,r){0!=e.length?r():r(new Error("请添加初始颜色"))}}}},loading:void 0,reader:void 0,displayResult:!1}},watch:{"formPreparation.fileList":function(){this.$refs.formPreparation.clearValidate("fileList")},"formPreparation.colors":function(){this.$refs.formPreparation.clearValidate("colors")}},methods:{doProcessFile:function(){var t=this;this.$refs.formPreparation.validate(function(e){e&&t.$refs.fileUpload.submit()})},updateFileList:function(t,e){this.formPreparation.fileList=e},onUploadFile:function(t){if(this.reader)return this.loading=this.$loading.service({fullscreen:!0,text:"正在处理中……",background:"#FFFFFF"}),this.reader.readAsDataURL(t),this.formPreparation.filelist=[],!1},onSaveFile:function(t){var e=this.$refs.canvasImage.toDataURL("image/png","image/png"),r=document.createElement("a");r.href=e,r.download="IMG_"+v.format(new Date,"YYYYMMDD_HHMMSS.png"),document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(e)},goBack:function(){this.displayResult=!1}},mounted:function(){var t=this,e=function(){if(t.displayResult){var e=t.$refs.canvasImage,r=t.$refs.imageArea,n=y(r.offsetWidth-2,r.offsetHeight-2,e.width,e.height);e.style.width=n.width+"px",e.style.height=n.height+"px"}},r=new FileReader;this.reader=r;var n=new Image,a=new w.a;r.addEventListener("load",function(t){n.src=t.target.result});var i=this;n.addEventListener("load",function(t){var e=y(i.formPreparation.maxWidth,i.formPreparation.maxHeight,this.width,this.height);i.$refs.canvasImage.width=e.width,i.$refs.canvasImage.height=e.height;var r=i.$refs.canvasImage.getContext("2d");r.drawImage(n,0,0,this.width,this.height,0,0,e.width,e.height);var o=i.$refs.canvasImage.width,s=i.$refs.canvasImage.height,u=r.getImageData(0,0,o,s);a.postMessage({imageData:u,dither:i.formPreparation.dither,initPoints:i.formPreparation.colors})}),n.addEventListener("error",function(){i.loading&&i.loading.close(),i.$alert("图片加载失败","错误",{type:"error",center:!0,roundButton:!0,showClose:!1,customClass:"dialogFailed"})}),a.addEventListener("message",function(r){r.data.message?alert(r.data.message):(i.$refs.canvasImage.getContext("2d").putImageData(r.data.imageData,0,0),t.displayResult=!0,t.$nextTick(function(){e(),t.loading&&t.loading.close()}))}),a.addEventListener("error",function(t){console.error("Error from worker.",t)}),window.addEventListener("resize",e)}},b={render:function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"KMeansMainFrame"},[t.displayResult?t._e():r("el-form",{ref:"formPreparation",staticClass:"formPreparation",attrs:{model:t.formPreparation,rules:t.formPreparation._validation,"label-width":"110px"}},[r("el-form-item",{attrs:{label:"选择文件",prop:"fileList"}},[r("el-upload",{ref:"fileUpload",staticClass:"fileUpload",attrs:{action:"","list-type":"picture",multiple:!1,limit:1,"show-file-list":!0,"auto-upload":!1,"on-change":t.updateFileList,"on-remove":t.updateFileList,"before-upload":t.onUploadFile}},[r("el-button",[t._v("打开图片文件")])],1)],1),t._v(" "),r("el-form-item",{attrs:{label:"图片最大宽度",prop:"maxWidth"}},[r("el-input",{model:{value:t.formPreparation.maxWidth,callback:function(e){t.$set(t.formPreparation,"maxWidth",t._n(e))},expression:"formPreparation.maxWidth"}})],1),t._v(" "),r("el-form-item",{attrs:{label:"图片最大高度",prop:"maxHeight"}},[r("el-input",{model:{value:t.formPreparation.maxHeight,callback:function(e){t.$set(t.formPreparation,"maxHeight",t._n(e))},expression:"formPreparation.maxHeight"}})],1),t._v(" "),r("el-form-item",{attrs:{label:"图像抖动",prop:"dither"}},[r("el-switch",{model:{value:t.formPreparation.dither,callback:function(e){t.$set(t.formPreparation,"dither",e)},expression:"formPreparation.dither"}})],1),t._v(" "),r("el-form-item",{attrs:{label:"初始颜色",prop:"colors"}},[r("colorManager",{model:{value:t.formPreparation.colors,callback:function(e){t.$set(t.formPreparation,"colors",e)},expression:"formPreparation.colors"}})],1),t._v(" "),r("el-button",{attrs:{type:"primary"},on:{click:t.doProcessFile}},[t._v("开始处理图片")])],1),t._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:t.displayResult,expression:"displayResult"}]},[r("el-button",{attrs:{type:"primary"},on:{click:t.onSaveFile}},[t._v("下载图片")]),r("el-button",{on:{click:t.goBack}},[t._v("返回")]),t._v(" "),r("div",{ref:"imageArea",staticClass:"imageArea"},[r("canvas",{ref:"canvasImage",staticClass:"canvasImage",attrs:{width:"16",height:"16"}})])],1)],1)},staticRenderFns:[]};var P=r("VU/8")(D,b,!1,function(t){r("ddy+"),r("SFns")},"data-v-0ab48ade",null);e.default=P.exports},SFns:function(t,e){},"ddy+":function(t,e){},fBUQ:function(t,e){},o1UL:function(t,e,r){t.exports=function(){return r("qDT4")('!function(t){var e={};function r(a){if(e[a])return e[a].exports;var n=e[a]={i:a,l:!1,exports:{}};return t[a].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=t,r.c=e,r.d=function(t,e,a){r.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:a})},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="./",r(r.s="o1UL")}({o1UL:function(t,e,r){"use strict";var a=function(t,e){this.targets=t.slice(),this.src=e};a.prototype={constructor:a,getMinDistance:function(t,e){for(var r,a=t.length,n=void 0,i=0;i<a;i++){var o=t[i],s=e[0]-o[0],h=e[1]-o[1],u=e[2]-o[2],d=s*s+h*h+u*u;(void 0===n||d<n)&&(n=d,r=i)}return r},getCentroids:function(t,e){for(var r=new Array(t.length),a=new Array,n=0;n<t.length;n++)a.push([0,0,0].slice()),r[n]=0;var i=e.length;for(n=0;n<i;n++){var o=e[n],s=this.getMinDistance(t,o);a[s][0]+=o[0],a[s][1]+=o[1],a[s][2]+=o[2],r[s]+=1}var h=0;for(n=0;n<a.length;n++){r[n]&&(a[n][0]/=r[n],a[n][1]/=r[n],a[n][2]/=r[n]);var u=a[n][0]-t[n][0],d=a[n][1]-t[n][1],c=a[n][2]-t[n][2];h+=u*u+d*d+c*c}return{result:a,delta:h/=3*a.length}},getOptimizedPalette(t,e){for(var r=void 0!==e?e:32,a=void 0!==t?t:.1,n=this.targets;r--;){var i=this.getCentroids(n,this.src);if(n=i.result,i.delta<a)break}for(var o=0;o<n.length;o++)for(var s=n[o],h=0;h<s.length;h++)n[o][h]=Math.round(s[h]);return n},getMap:function(t,e){for(var r=e.length,a=[],n=0;n<r;n++){var i=this.getMinDistance(t,e[n]);a.push(t[i].slice())}return a},getMapDither:function(t,e,r,a){for(var n=e.length,i=[],o=0;o<n;o++)i.push(e[o].slice());for(var s=0;s<a;s++)for(var h=0;h<r;h++){var u=i[s*r+h].slice(),d=t[this.getMinDistance(t,u)].slice();i[s*r+h]=d;var c,f=[u[0]-d[0],u[1]-d[1],u[2]-d[2]];if(h+1<r)(c=i[s*r+h+1])[0]=Math.round(c[0]+7*f[0]/16),c[1]=Math.round(c[1]+7*f[1]/16),c[2]=Math.round(c[2]+7*f[2]/16);if(h-1>0&&s+1<a)(c=i[(s+1)*r+h-1])[0]=Math.round(c[0]+3*f[0]/16),c[1]=Math.round(c[1]+3*f[1]/16),c[2]=Math.round(c[2]+3*f[2]/16);if(s+1<a)(c=i[(s+1)*r+h])[0]=Math.round(c[0]+5*f[0]/16),c[1]=Math.round(c[1]+5*f[1]/16),c[2]=Math.round(c[2]+5*f[2]/16);if(h+1<r&&s+1<a)(c=i[(s+1)*r+h+1])[0]=Math.round(c[0]+1*f[0]/16),c[1]=Math.round(c[1]+1*f[1]/16),c[2]=Math.round(c[2]+1*f[2]/16)}return i},process:function(t){return t.dither?this.getMapDither(this.getOptimizedPalette(t.delta,t.times),this.src,t.w,t.h):this.getMap(this.getOptimizedPalette(t.delta,t.times),this.src,t.w,t.h)}},self.addEventListener("message",function(t){var e=t.data.imageData,r=function(t){for(var e=new Array,r=t.width*t.height,a=t.data,n=0;n<r;n++)e.push([a[4*n],a[4*n+1],a[4*n+2]]);return e}(t.data.imageData),n=new a(t.data.initPoints,r).process({w:e.width,h:e.height,dither:t.data.dither});!function(t,e){for(var r=t.width*t.height,a=0;a<r;a++)t.data[4*a]=e[a][0],t.data[4*a+1]=e[a][1],t.data[4*a+2]=e[a][2]}(t.data.imageData,n),self.postMessage({imageData:t.data.imageData})})}});',null)}},qDT4:function(t,e,r){"use strict";var n=window.URL||window.webkitURL;t.exports=function(t,e){try{try{var r;try{(r=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder)).append(t),r=r.getBlob()}catch(e){r=new Blob([t])}return new Worker(n.createObjectURL(r))}catch(e){return new Worker("data:application/javascript,"+encodeURIComponent(t))}}catch(t){if(!e)throw Error("Inline worker is not supported");return new Worker(e)}}},svXp:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r("BO1k"),a=r.n(n),i=function(t,e,r){return"#"+(t<=15?"0"+t.toString(16):t.toString(16))+(e<=15?"0"+e.toString(16):e.toString(16))+(r<=15?"0"+r.toString(16):r.toString(16))},o={props:{value:{default:function(){return[]}}},data:function(){return{editing:!1,colors:[]}},watch:{value:function(t){if(console.log("Incoming value changed.",t),Array.isArray(t)&&t.length){this.colors=[];var e=!0,r=!1,n=void 0;try{for(var o,s=a()(t);!(e=(o=s.next()).done);e=!0){var u=o.value;this.colors.push({value:i(u[0],u[1],u[2])})}}catch(t){r=!0,n=t}finally{try{!e&&s.return&&s.return()}finally{if(r)throw n}}}}},methods:{startEditing:function(){this.editing=!0},deleteColor:function(t){this.colors.splice(t,1),this.update()},addColor:function(){this.colors.push({value:"#000000"}),this.update()},update:function(){this.$emit("input",this.colors.map(function(t){return[parseInt(t.value.slice(1,3),16),parseInt(t.value.slice(3,5),16),parseInt(t.value.slice(5,7),16)]}))}},created:function(){for(var t=0;t<27;t++){var e=[0,127,255],r=e[Math.floor(t/9)%3],n=e[Math.floor(t/3)%3],a=e[t%3];this.colors.push({value:i(r,n,a)})}},mounted:function(){this.update()}},s={render:function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[t.editing?t._e():r("el-button",{on:{click:t.startEditing}},[t._v("编辑初始颜色")]),t._v(" "),t.editing?r("ul",[t._l(t.colors,function(e,n){return r("li",{key:n},[r("el-color-picker",{on:{change:t.update},model:{value:e.value,callback:function(r){t.$set(e,"value",r)},expression:"color.value"}}),t._v(" "),r("span",{staticClass:"colorDisp",domProps:{textContent:t._s(e.value)}}),t._v(" "),r("el-button",{attrs:{type:"text",icon:"el-icon-delete"},on:{click:function(e){t.deleteColor(n)}}})],1)}),t._v(" "),r("li",[r("el-button",{staticClass:"buttonAdd",attrs:{type:"text",icon:"el-icon-plus"},on:{click:t.addColor}})],1)],2):t._e()],1)},staticRenderFns:[]};var u=r("VU/8")(o,s,!1,function(t){r("fBUQ")},"data-v-630139be",null);e.default=u.exports}});