(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["KMeansPosterization"],{"00b5":function(t,e,a){"use strict";var r=a("7958"),n=a.n(r);n.a},"1cb4":function(t,e,a){},"2ccd":function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[t.editing?t._e():a("el-button",{on:{click:t.startEditing}},[t._v("编辑初始颜色")]),t.editing?a("div",{staticClass:"editorContainer"},[t._l(t.colors,function(e,r){return a("el-color-picker",{key:r,staticClass:"colorItem",on:{change:function(e){return t.checkColor(r,e)}},model:{value:e.value,callback:function(a){t.$set(e,"value",a)},expression:"color.value"}})}),a("div",{staticClass:"toolBox"},[a("el-button-group",[a("el-button",{staticClass:"textButton",attrs:{type:"text",icon:"el-icon-plus"},on:{click:t.addColor}}),a("el-button",{staticClass:"textButton",attrs:{type:"text",icon:"el-icon-refresh"},on:{click:t.resetColors}}),a("el-button",{staticClass:"textButton",attrs:{type:"text",icon:"el-icon-download"},on:{click:t.downloadPalette}})],1),a("el-upload",{staticClass:"paletteUpload",attrs:{action:"",multiple:!1,limit:1,"show-file-list":!1,"auto-upload":!0,"before-upload":t.handlePaletteUpload}},[a("el-button",{staticClass:"textButton",attrs:{type:"text",icon:"el-icon-upload2"},on:{click:t.resetColors}})],1)],1)],2):t._e()],1)},n=[],i=a("9d2f"),o=i["a"],s=(a("7070"),a("2877")),l=Object(s["a"])(o,r,n,!1,null,"9f70fb8a",null);e["default"]=l.exports},3969:function(t,e,a){},"50de":function(t,e,a){t.exports=function(){return a("7785")('(function(t){var e={};function r(n){if(e[n])return e[n].exports;var a=e[n]={i:n,l:!1,exports:{}};return t[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)r.d(n,a,function(e){return t[e]}.bind(null,a));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s="3296")})({3296:function(t,e,r){"use strict";var n=function(t,e){this.targets=t.slice(),this.src=e};function a(t){for(var e=new Array,r=t.width*t.height,n=t.data,a=0;a<r;a++)e.push([n[4*a],n[4*a+1],n[4*a+2]]);return e}function i(t,e){for(var r=t.width*t.height,n=0;n<r;n++)t.data[4*n]=e[n][0],t.data[4*n+1]=e[n][1],t.data[4*n+2]=e[n][2]}n.prototype={constructor:n,getMinDistance:function(t,e){for(var r,n=t.length,a=void 0,i=0;i<n;i++){var o=t[i],u=e[0]-o[0],s=e[1]-o[1],d=e[2]-o[2],h=u*u+s*s+d*d;(void 0===a||h<a)&&(a=h,r=i)}return r},getCentroids:function(t,e){for(var r=new Array(t.length),n=new Array,a=0;a<t.length;a++)n.push([0,0,0].slice()),r[a]=0;var i=e.length;for(a=0;a<i;a++){var o=e[a],u=this.getMinDistance(t,o);n[u][0]+=o[0],n[u][1]+=o[1],n[u][2]+=o[2],r[u]+=1}var s=0;for(a=0;a<n.length;a++){r[a]&&(n[a][0]/=r[a],n[a][1]/=r[a],n[a][2]/=r[a]);var d=n[a][0]-t[a][0],h=n[a][1]-t[a][1],f=n[a][2]-t[a][2];s+=d*d+h*h+f*f}return s/=3*n.length,{result:n,delta:s}},getOptimizedPalette:function(t,e){var r=void 0!==e?e:32,n=void 0!==t?t:.1,a=this.targets;while(r--){var i=this.getCentroids(a,this.src);if(a=i.result,i.delta<n)break}for(var o=0;o<a.length;o++)for(var u=a[o],s=0;s<u.length;s++)a[o][s]=Math.round(u[s]);return a},getMap:function(t,e){for(var r=e.length,n=[],a=0;a<r;a++){var i=this.getMinDistance(t,e[a]);n.push(t[i].slice())}return n},getMapDither:function(t,e,r,n){for(var a=e.length,i=[],o=0;o<a;o++)i.push(e[o].slice());for(var u=0;u<n;u++)for(var s=0;s<r;s++){var d=i[u*r+s].slice(),h=t[this.getMinDistance(t,d)].slice();i[u*r+s]=h;var f=[d[0]-h[0],d[1]-h[1],d[2]-h[2]];if(s+1<r){var l=i[u*r+s+1];l[0]=Math.round(l[0]+7*f[0]/16),l[1]=Math.round(l[1]+7*f[1]/16),l[2]=Math.round(l[2]+7*f[2]/16)}if(s-1>0&&u+1<n){l=i[(u+1)*r+s-1];l[0]=Math.round(l[0]+3*f[0]/16),l[1]=Math.round(l[1]+3*f[1]/16),l[2]=Math.round(l[2]+3*f[2]/16)}if(u+1<n){l=i[(u+1)*r+s];l[0]=Math.round(l[0]+5*f[0]/16),l[1]=Math.round(l[1]+5*f[1]/16),l[2]=Math.round(l[2]+5*f[2]/16)}if(s+1<r&&u+1<n){l=i[(u+1)*r+s+1];l[0]=Math.round(l[0]+1*f[0]/16),l[1]=Math.round(l[1]+1*f[1]/16),l[2]=Math.round(l[2]+1*f[2]/16)}}return i},process:function(t){return t.dither?this.getMapDither(this.getOptimizedPalette(t.delta,t.times),this.src,t.w,t.h):this.getMap(this.getOptimizedPalette(t.delta,t.times),this.src,t.w,t.h)}},self.addEventListener("message",function(t){var e=t.data.imageData,r=a(t.data.imageData),o=new n(t.data.initPoints,r),u=o.process({w:e.width,h:e.height,dither:t.data.dither});i(t.data.imageData,u),self.postMessage({imageData:t.data.imageData})})}});',null)}},6054:function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"KMeansMainFrame"},[t.displayResult?t._e():a("el-form",{ref:"formPreparation",staticClass:"formPreparation",attrs:{model:t.formPreparation,rules:t.formPreparation._validation,disabled:t.loading,size:"small","label-width":"110px"}},[a("el-form-item",{attrs:{label:"选择文件",prop:"fileList"}},[a("el-upload",{staticClass:"fileUpload",attrs:{action:"","list-type":"picture",multiple:!1,limit:1,"show-file-list":!0,"auto-upload":!1,"on-change":t.updateFileList,"on-remove":t.updateFileList,"on-exceed":t.noMoreFiles}},[a("el-button",[t._v("打开图片文件")])],1)],1),a("el-form-item",{staticClass:"imageSizeInput",attrs:{label:"图片最大宽度",prop:"maxWidth"}},[a("el-input",{model:{value:t.formPreparation.maxWidth,callback:function(e){t.$set(t.formPreparation,"maxWidth",t._n(e))},expression:"formPreparation.maxWidth"}})],1),a("el-form-item",{staticClass:"imageSizeInput",attrs:{label:"图片最大高度",prop:"maxHeight"}},[a("el-input",{model:{value:t.formPreparation.maxHeight,callback:function(e){t.$set(t.formPreparation,"maxHeight",t._n(e))},expression:"formPreparation.maxHeight"}})],1),a("el-form-item",{attrs:{label:"图像抖动",prop:"dither"}},[a("el-switch",{model:{value:t.formPreparation.dither,callback:function(e){t.$set(t.formPreparation,"dither",e)},expression:"formPreparation.dither"}})],1),a("el-form-item",{attrs:{label:"初始颜色",prop:"colors"}},[a("colorManager",{model:{value:t.formPreparation.colors,callback:function(e){t.$set(t.formPreparation,"colors",e)},expression:"formPreparation.colors"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary",disabled:t.loading,icon:t.loading?"el-icon-loading":null},on:{click:t.doProcessFile}},[t._v("\n        "+t._s(t.loading?"图片处理中":"开始处理图片")+"\n      ")])],1)],1),a("div",{directives:[{name:"show",rawName:"v-show",value:t.displayResult,expression:"displayResult"}]},[a("el-button",{attrs:{size:"small",type:"primary"},on:{click:t.onSaveFile}},[t._v("下载图片")]),a("el-button",{attrs:{size:"small"},on:{click:t.goBack}},[t._v("返回")]),a("div",{ref:"imageArea",staticClass:"imageArea"},[a("canvas",{ref:"canvasImage",staticClass:"canvasImage",attrs:{width:"16",height:"16"}})])],1)],1)},n=[],i=a("768b"),o=a("9285"),s=a("50de"),l=a.n(s),u=a("791e");function c(t,e,a,r){if(a<=t&&r<=e)return{width:a,height:r};var n=0,o=0,s=Object(u["b"])(t,e,a,r),l=Object(i["a"])(s,2);return n=l[0],o=l[1],{width:n,height:o}}var d={components:{colorManager:a("2ccd").default},data:function(){return{formPreparation:{maxWidth:640,maxHeight:640,dither:!1,fileList:[],colors:[],_validation:{fileList:{required:!0,validator:function(t,e,a){0!=e.length?a():a(new Error("请选择文件"))}},maxWidth:[{required:!0,message:"请填写图片最大宽度"},{type:"number",message:"请输入数字类型的值"}],maxHeight:[{required:!0,message:"请填写图片最大宽度"},{type:"number",message:"请输入数字类型的值"}],colors:{required:!0,validator:function(t,e,a){0!=e.length?a():a(new Error("请添加初始颜色"))}}}},loading:!1,reader:void 0,displayResult:!1}},watch:{"formPreparation.fileList":function(){this.$refs.formPreparation.clearValidate("fileList")},"formPreparation.colors":function(){this.$refs.formPreparation.clearValidate("colors")}},methods:{updateFileList:function(t,e){this.formPreparation.fileList=e},doProcessFile:function(){var t=this;this.$refs.formPreparation.validate(function(e){e&&(t.loading=!0,t.reader.readAsDataURL(t.formPreparation.fileList[0].raw))})},noMoreFiles:function(){this.$alert("一次只能打开一个文件。",{type:"error"})},onSaveFile:function(t){var e="IMG_"+o["a"].format(new Date,"YYYYMMDD_HHMMSS.png");saveAs(this.$refs.canvasImage.toDataURL("image/png"),e)},goBack:function(){this.displayResult=!1,this.resetForm()},resetForm:function(){this.formPreparation.filelist=[]}},mounted:function(){var t=this,e=function(){if(t.displayResult){var e=t.$refs.canvasImage,a=t.$refs.imageArea,r=c(a.offsetWidth-2,a.offsetHeight-2,e.width,e.height);e.style.width="".concat(r.width,"px"),e.style.height="".concat(r.height,"px")}},a=new FileReader;this.reader=a;var r=new Image,n=new l.a;a.addEventListener("load",function(t){r.src=t.target.result});var i=this;r.addEventListener("load",function(t){var e=c(i.formPreparation.maxWidth,i.formPreparation.maxHeight,this.width,this.height);i.$refs.canvasImage.width=e.width,i.$refs.canvasImage.height=e.height;var a=i.$refs.canvasImage.getContext("2d");a.drawImage(r,0,0,this.width,this.height,0,0,e.width,e.height);var o=i.$refs.canvasImage.width,s=i.$refs.canvasImage.height,l=a.getImageData(0,0,o,s);n.postMessage({imageData:l,dither:i.formPreparation.dither,initPoints:i.formPreparation.colors})}),r.addEventListener("error",function(){i.loading=!1,i.resetForm(),i.$alert("图片加载失败","错误",{type:"error",center:!0,roundButton:!0,showClose:!1,customClass:"dialogFailed"})}),n.addEventListener("message",function(a){if(a.data.message)alert(a.data.message);else{var r=i.$refs.canvasImage.getContext("2d");r.putImageData(a.data.imageData,0,0),t.displayResult=!0,t.$nextTick(function(){e(),t.loading=!1})}}),n.addEventListener("error",function(t){console.error("Error from worker.",t)}),window.addEventListener("resize",e)}},f=d,h=(a("c5b0"),a("00b5"),a("2877")),p=Object(h["a"])(f,r,n,!1,null,"30c4eada",null);e["default"]=p.exports},7070:function(t,e,a){"use strict";var r=a("1cb4"),n=a.n(r);n.a},7785:function(t,e,a){"use strict";var r=window.URL||window.webkitURL;t.exports=function(t,e){try{try{var a;try{var n=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;a=new n,a.append(t),a=a.getBlob()}catch(i){a=new Blob([t])}return new Worker(r.createObjectURL(a))}catch(i){return new Worker("data:application/javascript,"+encodeURIComponent(t))}}catch(i){if(!e)throw Error("Inline worker is not supported");return new Worker(e)}}},7958:function(t,e,a){},"9d2f":function(t,e,a){"use strict";(function(t){a("28a5"),a("ac4d"),a("8a81"),a("ac6a"),a("6b54");var r=a("21a6"),n=function(t,e,a){var r=t<=15?"0"+t.toString(16):t.toString(16),n=e<=15?"0"+e.toString(16):e.toString(16),i=a<=15?"0"+a.toString(16):a.toString(16);return"#".concat(r).concat(n).concat(i)};e["a"]={props:{value:{default:function(){return[]}}},data:function(){return{editing:!1,colors:[]}},watch:{value:function(t){if(Array.isArray(t)&&t.length){this.colors=[];var e=!0,a=!1,r=void 0;try{for(var i,o=t[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var s=i.value;this.colors.push({value:n(s[0],s[1],s[2])})}}catch(l){a=!0,r=l}finally{try{e||null==o.return||o.return()}finally{if(a)throw r}}}}},methods:{startEditing:function(){this.editing=!0},deleteColor:function(t){this.colors.splice(t,1),this.update()},addColor:function(){this.colors.push({value:"#000000"}),this.update()},checkColor:function(t,e){e?this.update():this.deleteColor(t)},resetColors:function(){this.colors=[];for(var t=0;t<27;t++){var e=[0,127,255],a=e[Math.floor(t/9)%3],r=e[Math.floor(t/3)%3],i=e[t%3];this.colors.push({value:n(a,r,i)})}this.update()},downloadPalette:function(){var t=this.colors.map(function(t){return t.value}).join("\n");Object(r["saveAs"])(new Blob([t],{type:"text/plain;charset=utf-8"}),"palette.pal")},handlePaletteUpload:function(e){var a=this,r=new FileReader;return r.addEventListener("load",function(e){var r=String.fromCharCode.apply(null,t.from(e.target.result.split(",")[1],"base64"));a.colors=[];var n=!0,i=!1,o=void 0;try{for(var s,l=r.split("\n")[Symbol.iterator]();!(n=(s=l.next()).done);n=!0){var u=s.value;if(!/^\#[0-9A-Fa-f]{6}$/.test(u))return;a.colors.push({value:u})}}catch(c){i=!0,o=c}finally{try{n||null==l.return||l.return()}finally{if(i)throw o}}}),r.readAsDataURL(e),!1},update:function(){this.$emit("input",this.colors.map(function(t){return[parseInt(t.value.slice(1,3),16),parseInt(t.value.slice(3,5),16),parseInt(t.value.slice(5,7),16)]}))}},mounted:function(){this.resetColors()}}}).call(this,a("b639").Buffer)},c5b0:function(t,e,a){"use strict";var r=a("3969"),n=a.n(r);n.a}}]);