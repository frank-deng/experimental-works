<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>Try Web Audio API</title>
    <script type='text/javascript' src='mobile_logger.js'></script>
    <script type='text/javascript'>
window.addEventListener('load', function(){
	MobileLogger.bind(document.getElementById('logger_element'));
});
    </script>
	<style type='text/css'>
#logger_element{
	display:block;
	position:fixed;
	left:0;
	right:0;
	top:0;
	bottom:0;
	font-size:1em;
	line-height:1.1em;
	font-family:monospace;
	font-weight:normal;
	color:#FFF;
	background-color:#000;
	border-top: 1px solid #b3d8ff;
	margin:0;
	padding:0;
	z-index: 100;
	word-break:break-all;
}
	</style>
  </head>
  <body>
    <pre id='logger_element'></pre>
  </body>
  <script>
var audioCtx = new AudioContext();
var gainMaster = audioCtx.createGain();
gainMaster.connect(this.audioCtx.destination);
gainMaster.gain.setValueAtTime(0.1, this.audioCtx.currentTime);
var mixer = this.audioCtx.createChannelMerger(1);
mixer.connect(gainMaster);
var gain = audioCtx.createGain();
gain.gain.setValueAtTime(0.5, this.audioCtx.currentTime);
gain.connect(mixer);

var noiseNode = audioCtx.createScriptProcessor(4096, 1, 1);
var value = Math.random()*2-1;
noiseNode.addEventListener('audioprocess', (e)=>{
	var len = e.outputBuffer.length;
	var input = e.inputBuffer.getChannelData(0);
	var output = e.outputBuffer.getChannelData(0);
    for (var i = 0; i < len; i++) {
    	if (i > 0 && (input[i]>0) !== (input[i-1]>0)){
    		value = Math.random()*2-1;
		}
		output[i] = value;
    }
});
noiseNode.connect(gain);

var oscillatorNode = audioCtx.createOscillator();
oscillatorNode.type = 'square';
oscillatorNode.frequency.setValueAtTime(1000, audioCtx.currentTime);
oscillatorNode.connect(noiseNode);
oscillatorNode.start();

oscillatorNode.frequency.setValueAtTime(1000, audioCtx.currentTime+1);
oscillatorNode.frequency.linearRampToValueAtTime(5000, audioCtx.currentTime+3);
oscillatorNode.frequency.setValueAtTime(5000, audioCtx.currentTime+5);
oscillatorNode.frequency.linearRampToValueAtTime(1000, audioCtx.currentTime+7);
oscillatorNode.frequency.setValueAtTime(0, audioCtx.currentTime+9);

var mute = ()=>{
	oscillatorNode.stop();
	noiseNode.disconnect();
}
    
document.body.addEventListener('click', mute);
window.addEventListener('keydown', mute);
  </script>
</html>
